<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>9 Case study: analyzing usenet text | Text Mining with R</title>
<meta name="author" content="Julia Silge and David Robinson">
<meta name="description" content="In our final chapter, we’ll use what we’ve learned in this book to perform a start-to-finish analysis of a set of 20,000 messages sent to 20 Usenet bulletin boards in 1993. The Usenet bulletin...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="9 Case study: analyzing usenet text | Text Mining with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://www.tidytextmining.com/usenet.html">
<meta property="og:image" content="https://www.tidytextmining.com/images/cover.png">
<meta property="og:description" content="In our final chapter, we’ll use what we’ve learned in this book to perform a start-to-finish analysis of a set of 20,000 messages sent to 20 Usenet bulletin boards in 1993. The Usenet bulletin...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="9 Case study: analyzing usenet text | Text Mining with R">
<meta name="twitter:description" content="In our final chapter, we’ll use what we’ve learned in this book to perform a start-to-finish analysis of a set of 20,000 messages sent to 20 Usenet bulletin boards in 1993. The Usenet bulletin...">
<meta name="twitter:image" content="https://www.tidytextmining.com/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-68765210-2', 'auto');
    ga('send', 'pageview');
  
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="A Tidy Approach">Text Mining with R</a>:
        <small class="text-muted">A Tidy Approach</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to Text Mining with R</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="tidytext.html"><span class="header-section-number">1</span> The tidy text format</a></li>
<li><a class="" href="sentiment.html"><span class="header-section-number">2</span> Sentiment analysis with tidy data</a></li>
<li><a class="" href="tfidf.html"><span class="header-section-number">3</span> Analyzing word and document frequency: tf-idf</a></li>
<li><a class="" href="ngrams.html"><span class="header-section-number">4</span> Relationships between words: n-grams and correlations</a></li>
<li><a class="" href="dtm.html"><span class="header-section-number">5</span> Converting to and from non-tidy formats</a></li>
<li><a class="" href="topicmodeling.html"><span class="header-section-number">6</span> Topic modeling</a></li>
<li><a class="" href="twitter.html"><span class="header-section-number">7</span> Case study: comparing Twitter archives</a></li>
<li><a class="" href="nasa.html"><span class="header-section-number">8</span> Case study: mining NASA metadata</a></li>
<li><a class="active" href="usenet.html"><span class="header-section-number">9</span> Case study: analyzing usenet text</a></li>
<li><a class="" href="references.html"><span class="header-section-number">10</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/dgrtwo/tidy-text-mining">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="usenet" class="section level1">
<h1>
<span class="header-section-number">9</span> Case study: analyzing usenet text<a class="anchor" aria-label="anchor" href="#usenet"><i class="fas fa-link"></i></a>
</h1>
<p>In our final chapter, we’ll use what we’ve learned in this book to perform a start-to-finish analysis of a set of 20,000 messages sent to 20 Usenet bulletin boards in 1993. The Usenet bulletin boards in this dataset include newsgroups for topics like politics, religion, cars, sports, and cryptography, and offer a rich set of text written by many users. This data set is publicly available at <a href="http://qwone.com/~jason/20Newsgroups/">http://qwone.com/~jason/20Newsgroups/</a> (the <code>20news-bydate.tar.gz</code> file) and has become popular for exercises in text analysis and machine learning.</p>
<div id="pre-processing" class="section level2">
<h2>
<span class="header-section-number">9.1</span> Pre-processing<a class="anchor" aria-label="anchor" href="#pre-processing"><i class="fas fa-link"></i></a>
</h2>
<p>We’ll start by reading in all the messages from the <code>20news-bydate</code> folder, which are organized in sub-folders with one file for each message. We can read in files like these with a combination of <code><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest()</a></code>.</p>
<div class="rmdwarning">
<p>
Note that this step may take several minutes to read all the documents.
</p>
</div>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">training_folder</span> <span class="op">&lt;-</span> <span class="st">"data/20news-bydate/20news-bydate-train/"</span>

<span class="co"># Define a function to read all files from a folder into a data frame</span>
<span class="va">read_folder</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">infolder</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="va">infolder</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">read_lines</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>, <span class="va">text</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Use unnest() and map() to apply read_folder to each subfolder</span>
<span class="va">raw_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>folder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="va">training_folder</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>folder_out <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">folder</span>, <span class="va">read_folder</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">folder_out</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>newsgroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">folder</span><span class="op">)</span>, <span class="va">id</span>, <span class="va">text</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw_text</span>
<span class="co">#&gt; # A tibble: 511,655 × 3</span>
<span class="co">#&gt;    newsgroup   id    text                                                       </span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                                                      </span>
<span class="co">#&gt;  1 alt.atheism 49960 "From: mathew &lt;mathew@mantis.co.uk&gt;"                       </span>
<span class="co">#&gt;  2 alt.atheism 49960 "Subject: Alt.Atheism FAQ: Atheist Resources"              </span>
<span class="co">#&gt;  3 alt.atheism 49960 "Summary: Books, addresses, music -- anything related to a…</span>
<span class="co">#&gt;  4 alt.atheism 49960 "Keywords: FAQ, atheism, books, music, fiction, addresses,…</span>
<span class="co">#&gt;  5 alt.atheism 49960 "Expires: Thu, 29 Apr 1993 11:57:19 GMT"                   </span>
<span class="co">#&gt;  6 alt.atheism 49960 "Distribution: world"                                      </span>
<span class="co">#&gt;  7 alt.atheism 49960 "Organization: Mantis Consultants, Cambridge. UK."         </span>
<span class="co">#&gt;  8 alt.atheism 49960 "Supersedes: &lt;19930301143317@mantis.co.uk&gt;"                </span>
<span class="co">#&gt;  9 alt.atheism 49960 "Lines: 290"                                               </span>
<span class="co">#&gt; 10 alt.atheism 49960 ""                                                         </span>
<span class="co">#&gt; # … with 511,645 more rows</span></code></pre></div>
<p>Notice the <code>newsgroup</code> column, which describes which of the 20 newsgroups each message comes from, and <code>id</code> column, which identifies a unique message within that newsgroup. What newsgroups are included, and how many messages were posted in each (Figure <a href="usenet.html#fig:messagecounts">9.1</a>)?</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="va">raw_text</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">newsgroup</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">messages</span>, <span class="va">newsgroup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:messagecounts"></span>
<img src="09-usenet_files/figure-html/messagecounts-1.png" alt="Number of messages from each newsgroup" width="90%"><p class="caption">
Figure 9.1: Number of messages from each newsgroup
</p>
</div>
<p>We can see that Usenet newsgroup names are named hierarchically, starting with a main topic such as “talk”, “sci”, or “rec”, followed by further specifications.</p>
<div id="pre-processing-text" class="section level3">
<h3>
<span class="header-section-number">9.1.1</span> Pre-processing text<a class="anchor" aria-label="anchor" href="#pre-processing-text"><i class="fas fa-link"></i></a>
</h3>
<p>Most of the datasets we’ve examined in this book were pre-processed, meaning we didn’t have to remove, for example, copyright notices from the Jane Austen novels. Here, however, each message has some structure and extra text that we don’t want to include in our analysis. For example, every message has a header, containing field such as “from:” or “in_reply_to:” that describe the message. Some also have automated email signatures, which occur after a line like <code>--</code>.</p>
<p>This kind of pre-processing can be done within the dplyr package, using a combination of <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> (cumulative sum) and <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> from stringr.</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org">stringr</a></span><span class="op">)</span>

<span class="co"># must occur after the first occurrence of an empty line,</span>
<span class="co"># and before the first occurrence of a line starting with --</span>
<span class="va">cleaned_text</span> <span class="op">&lt;-</span> <span class="va">raw_text</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">text</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>,
         <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"^--"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Many lines also have nested text representing quotes from other users, typically starting with a line like “so-and-so writes…” These can be removed with a few regular expressions.</p>
<div class="rmdnote">
<p>
We also choose to manually remove two messages, <code>9704</code> and <code>9985</code> that contained a large amount of non-text content.
</p>
</div>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cleaned_text</span> <span class="op">&lt;-</span> <span class="va">cleaned_text</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"^[^&gt;]+[A-Za-z\\d]"</span><span class="op">)</span> <span class="op">|</span> <span class="va">text</span> <span class="op">==</span> <span class="st">""</span>,
         <span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"writes(:|\\.\\.\\.)$"</span><span class="op">)</span>,
         <span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"^In article &lt;"</span><span class="op">)</span>,
         <span class="op">!</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9704</span>, <span class="fl">9985</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>At that point, we’re ready to use <code><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens()</a></code> to split the dataset into tokens, while removing stop-words.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext">tidytext</a></span><span class="op">)</span>

<span class="va">usenet_words</span> <span class="op">&lt;-</span> <span class="va">cleaned_text</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">text</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"[a-z']$"</span><span class="op">)</span>,
         <span class="op">!</span><span class="va">word</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">stop_words</span><span class="op">$</span><span class="va">word</span><span class="op">)</span></code></pre></div>
<p>Every raw text dataset will require different steps for data cleaning, which will often involve some trial-and-error and exploration of unusual cases in the dataset. It’s important to notice that this cleaning can be achieved using tidy tools such as dplyr and tidyr.</p>
</div>
</div>
<div id="words-in-newsgroups" class="section level2">
<h2>
<span class="header-section-number">9.2</span> Words in newsgroups<a class="anchor" aria-label="anchor" href="#words-in-newsgroups"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we’ve removed the headers, signatures, and formatting, we can start exploring common words. For starters, we could find the most common words in the entire dataset, or within particular newsgroups.</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usenet_words</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">word</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 68,137 × 2</span>
<span class="co">#&gt;    word            n</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;int&gt;</span>
<span class="co">#&gt;  1 people       3655</span>
<span class="co">#&gt;  2 time         2705</span>
<span class="co">#&gt;  3 god          1626</span>
<span class="co">#&gt;  4 system       1595</span>
<span class="co">#&gt;  5 program      1103</span>
<span class="co">#&gt;  6 bit          1097</span>
<span class="co">#&gt;  7 information  1094</span>
<span class="co">#&gt;  8 windows      1088</span>
<span class="co">#&gt;  9 government   1084</span>
<span class="co">#&gt; 10 space        1072</span>
<span class="co">#&gt; # … with 68,127 more rows</span>

<span class="va">words_by_newsgroup</span> <span class="op">&lt;-</span> <span class="va">usenet_words</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="va">word</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">words_by_newsgroup</span>
<span class="co">#&gt; # A tibble: 173,913 × 3</span>
<span class="co">#&gt;    newsgroup               word          n</span>
<span class="co">#&gt;    &lt;chr&gt;                   &lt;chr&gt;     &lt;int&gt;</span>
<span class="co">#&gt;  1 soc.religion.christian  god         917</span>
<span class="co">#&gt;  2 sci.space               space       840</span>
<span class="co">#&gt;  3 talk.politics.mideast   people      728</span>
<span class="co">#&gt;  4 sci.crypt               key         704</span>
<span class="co">#&gt;  5 comp.os.ms-windows.misc windows     625</span>
<span class="co">#&gt;  6 talk.politics.mideast   armenian    582</span>
<span class="co">#&gt;  7 sci.crypt               db          549</span>
<span class="co">#&gt;  8 talk.politics.mideast   turkish     514</span>
<span class="co">#&gt;  9 rec.autos               car         509</span>
<span class="co">#&gt; 10 talk.politics.mideast   armenians   509</span>
<span class="co">#&gt; # … with 173,903 more rows</span></code></pre></div>
<div id="finding-tf-idf-within-newsgroups" class="section level3">
<h3>
<span class="header-section-number">9.2.1</span> Finding tf-idf within newsgroups<a class="anchor" aria-label="anchor" href="#finding-tf-idf-within-newsgroups"><i class="fas fa-link"></i></a>
</h3>
<p>We’d expect the newsgroups to differ in terms of topic and content, and therefore for the frequency of words to differ between them. Let’s try quantifying this using the tf-idf metric (Chapter <a href="tfidf.html#tfidf">3</a>).</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tf_idf</span> <span class="op">&lt;-</span> <span class="va">words_by_newsgroup</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/bind_tf_idf.html">bind_tf_idf</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">newsgroup</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">tf_idf</span><span class="op">)</span><span class="op">)</span>

<span class="va">tf_idf</span>
<span class="co">#&gt; # A tibble: 173,913 × 6</span>
<span class="co">#&gt;    newsgroup                word               n      tf   idf tf_idf</span>
<span class="co">#&gt;    &lt;chr&gt;                    &lt;chr&gt;          &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 comp.sys.ibm.pc.hardware scsi             483 0.0176   1.20 0.0212</span>
<span class="co">#&gt;  2 talk.politics.mideast    armenian         582 0.00805  2.30 0.0185</span>
<span class="co">#&gt;  3 rec.motorcycles          bike             324 0.0139   1.20 0.0167</span>
<span class="co">#&gt;  4 talk.politics.mideast    armenians        509 0.00704  2.30 0.0162</span>
<span class="co">#&gt;  5 sci.crypt                encryption       410 0.00816  1.90 0.0155</span>
<span class="co">#&gt;  6 rec.sport.hockey         nhl              157 0.00440  3.00 0.0132</span>
<span class="co">#&gt;  7 talk.politics.misc       stephanopoulos   158 0.00416  3.00 0.0125</span>
<span class="co">#&gt;  8 rec.motorcycles          bikes             97 0.00416  3.00 0.0125</span>
<span class="co">#&gt;  9 rec.sport.hockey         hockey           270 0.00756  1.61 0.0122</span>
<span class="co">#&gt; 10 comp.windows.x           oname            136 0.00354  3.00 0.0106</span>
<span class="co">#&gt; # … with 173,903 more rows</span></code></pre></div>
<p>We can examine the top tf-idf for a few selected groups to extract words specific to those topics. For example, we could look at all the <code>sci.</code> boards, visualized in Figure <a href="usenet.html#fig:scitfidf">9.2</a>.</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tf_idf</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="st">"^sci\\."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">newsgroup</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">tf_idf</span>, n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">tf_idf</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">tf_idf</span>, <span class="va">word</span>, fill <span class="op">=</span> <span class="va">newsgroup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">newsgroup</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"tf-idf"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:scitfidf"></span>
<img src="09-usenet_files/figure-html/scitfidf-1.png" alt="Terms with the highest tf-idf within each of the science-related newsgroups" width="90%"><p class="caption">
Figure 9.2: Terms with the highest tf-idf within each of the science-related newsgroups
</p>
</div>
<p>We see lots of characteristic words specific to a particular newsgroup, such as “wiring” and “circuit” on the sci.electronics topic and “orbit” and “lunar” for the space newsgroup. You could use this same code to explore other newsgroups yourself.</p>
<p>What newsgroups tended to be similar to each other in text content? We could discover this by finding the pairwise correlation of word frequencies within each newsgroup, using the <code><a href="https://rdrr.io/pkg/widyr/man/pairwise_cor.html">pairwise_cor()</a></code> function from the widyr package (see Chapter <a href="ngrams.html#pairwise-correlation">4.2.2</a>).</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dgrtwo/widyr">widyr</a></span><span class="op">)</span>

<span class="va">newsgroup_cors</span> <span class="op">&lt;-</span> <span class="va">words_by_newsgroup</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/widyr/man/pairwise_cor.html">pairwise_cor</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="va">word</span>, <span class="va">n</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">newsgroup_cors</span>
<span class="co">#&gt; # A tibble: 380 × 3</span>
<span class="co">#&gt;    item1                    item2                    correlation</span>
<span class="co">#&gt;    &lt;chr&gt;                    &lt;chr&gt;                          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 talk.religion.misc       soc.religion.christian         0.835</span>
<span class="co">#&gt;  2 soc.religion.christian   talk.religion.misc             0.835</span>
<span class="co">#&gt;  3 alt.atheism              talk.religion.misc             0.779</span>
<span class="co">#&gt;  4 talk.religion.misc       alt.atheism                    0.779</span>
<span class="co">#&gt;  5 alt.atheism              soc.religion.christian         0.751</span>
<span class="co">#&gt;  6 soc.religion.christian   alt.atheism                    0.751</span>
<span class="co">#&gt;  7 comp.sys.mac.hardware    comp.sys.ibm.pc.hardware       0.680</span>
<span class="co">#&gt;  8 comp.sys.ibm.pc.hardware comp.sys.mac.hardware          0.680</span>
<span class="co">#&gt;  9 rec.sport.baseball       rec.sport.hockey               0.577</span>
<span class="co">#&gt; 10 rec.sport.hockey         rec.sport.baseball             0.577</span>
<span class="co">#&gt; # … with 370 more rows</span></code></pre></div>
<p>We could then filter for stronger correlations among newsgroups, and visualize them in a network (Figure (fig:newsgroupcorsnetwork).</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com">ggraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2017</span><span class="op">)</span>

<span class="va">newsgroup_cors</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">correlation</span> <span class="op">&gt;</span> <span class="fl">.4</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">graph_from_data_frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span>layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">correlation</span>, width <span class="op">=</span> <span class="va">correlation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span>, color <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">name</span><span class="op">)</span>, repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:newsgroupcorsnetwork"></span>
<img src="09-usenet_files/figure-html/newsgroupcorsnetwork-1.png" alt="A network of Usenet groups based on the correlation of word counts between them, including only connections with a correlation greater than .4" width="90%"><p class="caption">
Figure 9.3: A network of Usenet groups based on the correlation of word counts between them, including only connections with a correlation greater than .4
</p>
</div>
<p>It looks like there were four main clusters of newsgroups: computers/electronics, politics/religion, motor vehicles, and sports. This certainly makes sense in terms of what words and topics we’d expect these newsgroups to have in common.</p>
</div>
<div id="topic-modeling-1" class="section level3">
<h3>
<span class="header-section-number">9.2.2</span> Topic modeling<a class="anchor" aria-label="anchor" href="#topic-modeling-1"><i class="fas fa-link"></i></a>
</h3>
<p>In Chapter <a href="topicmodeling.html#topicmodeling">6</a>, we used the latent Dirichlet allocation (LDA) algorithm to divide a set of chapters into the books they originally came from. Could LDA do the same to sort out Usenet messages that came from different newsgroups?</p>
<p>Let’s try dividing up messages from the four science-related newsgroups. We first process these into a document-term matrix with <code><a href="https://rdrr.io/pkg/tidytext/man/document_term_casters.html">cast_dtm()</a></code> (Chapter <a href="dtm.html#cast-dtm">5.2</a>), then fit the model with the <code><a href="https://rdrr.io/pkg/topicmodels/man/lda.html">LDA()</a></code> function from the topicmodels package.</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># include only words that occur at least 50 times</span>
<span class="va">word_sci_newsgroups</span> <span class="op">&lt;-</span> <span class="va">usenet_words</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="st">"^sci"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word_total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">word_total</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span>

<span class="co"># convert into a document-term matrix</span>
<span class="co"># with document names such as sci.crypt_14147</span>
<span class="va">sci_dtm</span> <span class="op">&lt;-</span> <span class="va">word_sci_newsgroups</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="va">document</span>, <span class="va">newsgroup</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">document</span>, <span class="va">word</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/document_term_casters.html">cast_dtm</a></span><span class="op">(</span><span class="va">document</span>, <span class="va">word</span>, <span class="va">n</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">topicmodels</span><span class="op">)</span>
<span class="va">sci_lda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/topicmodels/man/lda.html">LDA</a></span><span class="op">(</span><span class="va">sci_dtm</span>, k <span class="op">=</span> <span class="fl">4</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>What four topics did this model extract, and did they match the four newsgroups? This approach will look familiar from Chapter <a href="topicmodeling.html#topicmodeling">6</a>: we visualize each topic based on the most frequent terms within it (Figure <a href="usenet.html#fig:usenettopicterms">9.4</a>).</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sci_lda</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">topic</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">beta</span>, n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/reorder_within.html">reorder_within</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">beta</span>, <span class="va">topic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">beta</span>, <span class="va">term</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">topic</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">topic</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/reorder_within.html">scale_y_reordered</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:usenettopicterms"></span>
<img src="09-usenet_files/figure-html/usenettopicterms-1.png" alt="Top words from each topic fit by LDA on the science-related newsgroups" width="90%"><p class="caption">
Figure 9.4: Top words from each topic fit by LDA on the science-related newsgroups
</p>
</div>
<p>From the top words, we can start to suspect which topics may capture which newsgroups. Topic 1 certainly represents the sci.space newsgroup (thus the most common word being “space”), and topic 2 is likely drawn from cryptography, with terms such as “key” and “encryption”. Just as we did in Chapter <a href="topicmodeling.html#per-document">6.2.2</a>, we can confirm this by seeing how documents from each newsgroup have higher “gamma” for each topic (Figure <a href="usenet.html#fig:usenetassignments">9.5</a>).</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sci_lda</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">document</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newsgroup"</span>, <span class="st">"id"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>newsgroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="va">gamma</span> <span class="op">*</span> <span class="va">topic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">topic</span><span class="op">)</span>, <span class="va">gamma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">newsgroup</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Topic"</span>,
       y <span class="op">=</span> <span class="st">"# of messages where this was the highest % topic"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:usenetassignments"></span>
<img src="09-usenet_files/figure-html/usenetassignments-1.png" alt="Distribution of gamma for each topic within each Usenet newsgroup" width="90%"><p class="caption">
Figure 9.5: Distribution of gamma for each topic within each Usenet newsgroup
</p>
</div>
<p>Much as we saw in the literature analysis, topic modeling was able to discover the distinct topics present in the text without needing to consult the labels.</p>
<p>Notice that the division of Usenet messages wasn’t as clean as the division of book chapters, with a substantial number of messages from each newsgroup getting high values of “gamma” for other topics. This isn’t surprising since many of the messages are short and could overlap in terms of common words (for example, discussions of space travel could include many of the same words as discussions of electronics). This is a realistic example of how LDA might divide documents into rough topics while still allowing a degree of overlap.</p>
</div>
</div>
<div id="sentiment-analysis" class="section level2">
<h2>
<span class="header-section-number">9.3</span> Sentiment analysis<a class="anchor" aria-label="anchor" href="#sentiment-analysis"><i class="fas fa-link"></i></a>
</h2>
<p>We can use the sentiment analysis techniques we explored in Chapter <a href="sentiment.html#sentiment">2</a> to examine how often positive and negative words occurred in these Usenet posts. Which newsgroups were the most positive or negative overall?</p>
<p>In this example we’ll use the AFINN sentiment lexicon, which provides numeric positivity values for each word, and visualize it with a bar plot (Figure <a href="usenet.html#fig:newsgroupsentiments">9.6</a>).</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newsgroup_sentiments</span> <span class="op">&lt;-</span> <span class="va">words_by_newsgroup</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/get_sentiments.html">get_sentiments</a></span><span class="op">(</span><span class="st">"afinn"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">newsgroup</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>

<span class="va">newsgroup_sentiments</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>newsgroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">newsgroup</span>, fill <span class="op">=</span> <span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average sentiment value"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:newsgroupsentiments"></span>
<img src="09-usenet_files/figure-html/newsgroupsentiments-1.png" alt="Average AFINN value for posts within each newsgroup" width="90%"><p class="caption">
Figure 9.6: Average AFINN value for posts within each newsgroup
</p>
</div>
<p>According to this analysis, the “misc.forsale” newsgroup was the most positive. This makes sense, since it likely included many positive adjectives about the products that users wanted to sell!</p>
<div id="sentiment-analysis-by-word" class="section level3">
<h3>
<span class="header-section-number">9.3.1</span> Sentiment analysis by word<a class="anchor" aria-label="anchor" href="#sentiment-analysis-by-word"><i class="fas fa-link"></i></a>
</h3>
<p>It’s worth looking deeper to understand <em>why</em> some newsgroups ended up more positive or negative than others. For that, we can examine the total positive and negative contributions of each word.</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contributions</span> <span class="op">&lt;-</span> <span class="va">usenet_words</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/get_sentiments.html">get_sentiments</a></span><span class="op">(</span><span class="st">"afinn"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>occurences <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
            contribution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>What are these contributions?</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contributions</span>
<span class="co">#&gt; # A tibble: 1,909 × 3</span>
<span class="co">#&gt;    word      occurences contribution</span>
<span class="co">#&gt;    &lt;chr&gt;          &lt;int&gt;        &lt;dbl&gt;</span>
<span class="co">#&gt;  1 abandon           13          -26</span>
<span class="co">#&gt;  2 abandoned         19          -38</span>
<span class="co">#&gt;  3 abandons           3           -6</span>
<span class="co">#&gt;  4 abduction          2           -4</span>
<span class="co">#&gt;  5 abhor              4          -12</span>
<span class="co">#&gt;  6 abhorred           1           -3</span>
<span class="co">#&gt;  7 abhorrent          2           -6</span>
<span class="co">#&gt;  8 abilities         16           32</span>
<span class="co">#&gt;  9 ability          177          354</span>
<span class="co">#&gt; 10 aboard             8            8</span>
<span class="co">#&gt; # … with 1,899 more rows</span></code></pre></div>
<p>Which words had the most effect on sentiment values overall (Figure <a href="usenet.html#fig:usenetcontributions">9.7</a>)?</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contributions</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">contribution</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">contribution</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">contribution</span>, <span class="va">word</span>, fill <span class="op">=</span> <span class="va">contribution</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:usenetcontributions"></span>
<img src="09-usenet_files/figure-html/usenetcontributions-1.png" alt="Words with the greatest contributions to positive/negative sentiment values in the Usenet text" width="90%"><p class="caption">
Figure 9.7: Words with the greatest contributions to positive/negative sentiment values in the Usenet text
</p>
</div>
<p>These words look generally reasonable as indicators of each message’s sentiment, but we can spot possible problems with the approach. “True” could just as easily be a part of “not true” or a similar negative expression, and the words “God” and “Jesus” are apparently very common on Usenet but could easily be used in many contexts, positive or negative.</p>
<p>We may also care about which words contributed the most <em>within each newsgroup</em>, so that we can see which newsgroups might be incorrectly estimated.</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top_sentiment_words</span> <span class="op">&lt;-</span> <span class="va">words_by_newsgroup</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/get_sentiments.html">get_sentiments</a></span><span class="op">(</span><span class="st">"afinn"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contribution <span class="op">=</span> <span class="va">value</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can calculate each word’s contribution to each newsgroup’s sentiment score, and visualize the strongest contributors from a selection of the groups (Figure <a href="usenet.html#fig:newsgroupsentiment">9.8</a>).</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top_sentiment_words</span>
<span class="co">#&gt; # A tibble: 13,063 × 5</span>
<span class="co">#&gt;    newsgroup              word       n value contribution</span>
<span class="co">#&gt;    &lt;chr&gt;                  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co">#&gt;  1 soc.religion.christian god      917     1      0.0144 </span>
<span class="co">#&gt;  2 soc.religion.christian jesus    440     1      0.00692</span>
<span class="co">#&gt;  3 talk.politics.guns     gun      425    -1     -0.00668</span>
<span class="co">#&gt;  4 talk.religion.misc     god      296     1      0.00465</span>
<span class="co">#&gt;  5 alt.atheism            god      268     1      0.00421</span>
<span class="co">#&gt;  6 soc.religion.christian faith    257     1      0.00404</span>
<span class="co">#&gt;  7 talk.religion.misc     jesus    256     1      0.00403</span>
<span class="co">#&gt;  8 talk.politics.mideast  killed   202    -3     -0.00953</span>
<span class="co">#&gt;  9 talk.politics.mideast  war      187    -2     -0.00588</span>
<span class="co">#&gt; 10 soc.religion.christian true     179     2      0.00563</span>
<span class="co">#&gt; # … with 13,053 more rows</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:newsgroupsentiment"></span>
<img src="09-usenet_files/figure-html/newsgroupsentiment-1.png" alt="Words that contributed the most to sentiment scores within each of six newsgroups" width="90%"><p class="caption">
Figure 9.8: Words that contributed the most to sentiment scores within each of six newsgroups
</p>
</div>
<p>This confirms our hypothesis about the “misc.forsale” newsgroup: most of the sentiment was driven by positive adjectives such as “excellent” and “perfect”. We can also see how much sentiment is confounded with topic. An atheism newsgroup is likely to discuss “god” in detail even in a negative context, and we can see that it makes the newsgroup look more positive. Similarly, the negative contribution of the word “gun” to the “talk.politics.guns” group will occur even when the members are discussing guns positively.</p>
<p>This helps remind us that sentiment analysis can be confounded by topic, and that we should always examine the influential words before interpreting it too deeply.</p>
</div>
<div id="sentiment-analysis-by-message" class="section level3">
<h3>
<span class="header-section-number">9.3.2</span> Sentiment analysis by message<a class="anchor" aria-label="anchor" href="#sentiment-analysis-by-message"><i class="fas fa-link"></i></a>
</h3>
<p>We can also try finding the most positive and negative individual messages, by grouping and summarizing by <code>id</code> rather than <code>newsgroup</code>.</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sentiment_messages</span> <span class="op">&lt;-</span> <span class="va">usenet_words</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/get_sentiments.html">get_sentiments</a></span><span class="op">(</span><span class="st">"afinn"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>sentiment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,
            words <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">words</span> <span class="op">&gt;=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<div class="rmdnote">
<p>
As a simple measure to reduce the role of randomness, we filtered out messages that had fewer than five words that contributed to sentiment.
</p>
</div>
<p>What were the most positive messages?</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sentiment_messages</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">sentiment</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3,554 × 4</span>
<span class="co">#&gt;    newsgroup               id     sentiment words</span>
<span class="co">#&gt;    &lt;chr&gt;                   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 rec.sport.hockey        53560       3.89    18</span>
<span class="co">#&gt;  2 rec.sport.hockey        53602       3.83    30</span>
<span class="co">#&gt;  3 rec.sport.hockey        53822       3.83     6</span>
<span class="co">#&gt;  4 rec.sport.hockey        53645       3.23    13</span>
<span class="co">#&gt;  5 rec.autos               102768      3.2      5</span>
<span class="co">#&gt;  6 misc.forsale            75965       3        5</span>
<span class="co">#&gt;  7 misc.forsale            76037       3        5</span>
<span class="co">#&gt;  8 rec.sport.baseball      104458      3       11</span>
<span class="co">#&gt;  9 rec.sport.hockey        53571       3        5</span>
<span class="co">#&gt; 10 comp.os.ms-windows.misc 9620        2.86     7</span>
<span class="co">#&gt; # … with 3,544 more rows</span></code></pre></div>
<p>Let’s check this by looking at the most positive message in the whole dataset. To assist in this we could write a short function for printing a specified message.</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">print_message</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">group</span>, <span class="va">message_id</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">cleaned_text</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">newsgroup</span> <span class="op">==</span> <span class="va">group</span>, <span class="va">id</span> <span class="op">==</span> <span class="va">message_id</span>, <span class="va">text</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">text</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">print_message</span><span class="op">(</span><span class="st">"rec.sport.hockey"</span>, <span class="fl">53560</span><span class="op">)</span>
<span class="co">#&gt; Everybody.  Please send me your predictions for the Stanley Cup Playoffs!</span>
<span class="co">#&gt; I want to see who people think will win.!!!!!!!</span>
<span class="co">#&gt; Please Send them in this format, or something comparable:</span>
<span class="co">#&gt; 1. Winner of Buffalo-Boston</span>
<span class="co">#&gt; 2. Winner of Montreal-Quebec</span>
<span class="co">#&gt; 3. Winner of Pittsburgh-New York</span>
<span class="co">#&gt; 4. Winner of New Jersey-Washington</span>
<span class="co">#&gt; 5. Winner of Chicago-(Minnesota/St.Louis)</span>
<span class="co">#&gt; 6. Winner of Toronto-Detroit</span>
<span class="co">#&gt; 7. Winner of Vancouver-Winnipeg</span>
<span class="co">#&gt; 8. Winner of Calgary-Los Angeles</span>
<span class="co">#&gt; 9. Winner of Adams Division (1-2 above)</span>
<span class="co">#&gt; 10. Winner of Patrick Division (3-4 above)</span>
<span class="co">#&gt; 11. Winner of Norris Division (5-6 above)</span>
<span class="co">#&gt; 12. Winner of Smythe Division (7-8 above)</span>
<span class="co">#&gt; 13. Winner of Wales Conference (9-10 above)</span>
<span class="co">#&gt; 14. Winner of Campbell Conference (11-12 above)</span>
<span class="co">#&gt; 15. Winner of Stanley Cup (13-14 above)</span>
<span class="co">#&gt; I will summarize the predictions, and see who is the biggest</span>
<span class="co">#&gt; INTERNET GURU PREDICTING GUY/GAL.</span>
<span class="co">#&gt; Send entries to Richard Madison</span>
<span class="co">#&gt; rrmadiso@napier.uwaterloo.ca</span>
<span class="co">#&gt; PS:  I will send my entries to one of you folks so you know when I say</span>
<span class="co">#&gt; I won, that I won!!!!!</span></code></pre></div>
<p>It looks like this message was chosen because it uses the word “winner” many times. How about the most negative message? Turns out it’s also from the hockey site, but has a very different attitude.</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sentiment_messages</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sentiment</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3,554 × 4</span>
<span class="co">#&gt;    newsgroup             id     sentiment words</span>
<span class="co">#&gt;    &lt;chr&gt;                 &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 rec.sport.hockey      53907      -3        6</span>
<span class="co">#&gt;  2 sci.electronics       53899      -3        5</span>
<span class="co">#&gt;  3 talk.politics.mideast 75918      -3        7</span>
<span class="co">#&gt;  4 rec.autos             101627     -2.83     6</span>
<span class="co">#&gt;  5 comp.graphics         37948      -2.8      5</span>
<span class="co">#&gt;  6 comp.windows.x        67204      -2.7     10</span>
<span class="co">#&gt;  7 talk.politics.guns    53362      -2.67     6</span>
<span class="co">#&gt;  8 alt.atheism           51309      -2.6      5</span>
<span class="co">#&gt;  9 comp.sys.mac.hardware 51513      -2.6      5</span>
<span class="co">#&gt; 10 rec.autos             102883     -2.6      5</span>
<span class="co">#&gt; # … with 3,544 more rows</span>

<span class="fu">print_message</span><span class="op">(</span><span class="st">"rec.sport.hockey"</span>, <span class="fl">53907</span><span class="op">)</span>
<span class="co">#&gt; Losers like us? You are the fucking moron who has never heard of the Western</span>
<span class="co">#&gt; Business School, or the University of Western Ontario for that matter. Why </span>
<span class="co">#&gt; don't you pull your head out of your asshole and smell something other than</span>
<span class="co">#&gt; shit for once so you can look on a map to see where UWO is! Back to hockey,</span>
<span class="co">#&gt; the North Stars should be moved because for the past few years they have</span>
<span class="co">#&gt; just been SHIT. A real team like Toronto would never be moved!!!</span>
<span class="co">#&gt; Andrew--</span></code></pre></div>
<p>Well, we can confidently say that the sentiment analysis worked!</p>
</div>
<div id="n-gram-analysis" class="section level3">
<h3>
<span class="header-section-number">9.3.3</span> N-gram analysis<a class="anchor" aria-label="anchor" href="#n-gram-analysis"><i class="fas fa-link"></i></a>
</h3>
<p>In Chapter <a href="ngrams.html#ngrams">4</a>, we considered the effect of words such as “not” and “no” on sentiment analysis of Jane Austen novels, such as considering whether a phrase like “don’t like” led to passages incorrectly being labeled as positive. The Usenet dataset is a much larger corpus of more modern text, so we may be interested in how sentiment analysis may be reversed in this text.</p>
<p>We’d start by finding and counting all the bigrams in the Usenet posts.</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usenet_bigrams</span> <span class="op">&lt;-</span> <span class="va">cleaned_text</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span><span class="va">bigram</span>, <span class="va">text</span>, token <span class="op">=</span> <span class="st">"ngrams"</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usenet_bigram_counts</span> <span class="op">&lt;-</span> <span class="va">usenet_bigrams</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">newsgroup</span>, <span class="va">bigram</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">bigram</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"word1"</span>, <span class="st">"word2"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></code></pre></div>
<p>We could then define a list of six words that we suspect are used in negation, such as “no”, “not”, and “without”, and visualize the sentiment-associated words that most often followed them (Figure <a href="usenet.html#fig:negatewords">9.9</a>). This shows the words that most often contributed in the “wrong” direction.</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">negate_words</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"not"</span>, <span class="st">"without"</span>, <span class="st">"no"</span>, <span class="st">"can't"</span>, <span class="st">"don't"</span>, <span class="st">"won't"</span><span class="op">)</span>

<span class="va">usenet_bigram_counts</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">word1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">negate_words</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">word1</span>, <span class="va">word2</span>, wt <span class="op">=</span> <span class="va">n</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/get_sentiments.html">get_sentiments</a></span><span class="op">(</span><span class="st">"afinn"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>word2 <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contribution <span class="op">=</span> <span class="va">value</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">word1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">contribution</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/reorder_within.html">reorder_within</a></span><span class="op">(</span><span class="va">word2</span>, <span class="va">contribution</span>, <span class="va">word1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">contribution</span>, <span class="va">word2</span>, fill <span class="op">=</span> <span class="va">contribution</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">word1</span>, scales <span class="op">=</span> <span class="st">"free"</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/reorder_within.html">scale_y_reordered</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sentiment value * # of occurrences"</span>,
       y <span class="op">=</span> <span class="st">"Words preceded by a negation"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:negatewords"></span>
<img src="09-usenet_files/figure-html/negatewords-1.png" alt="Words that contributed the most to sentiment when they followed a 'negating' word" width="90%"><p class="caption">
Figure 9.9: Words that contributed the most to sentiment when they followed a ‘negating’ word
</p>
</div>
<p>It looks like the largest sources of misidentifying a word as positive come from “don’t want/like/care”, and the largest source of incorrectly classified negative sentiment is “no problem”.</p>
</div>
</div>
<div id="summary-8" class="section level2">
<h2>
<span class="header-section-number">9.4</span> Summary<a class="anchor" aria-label="anchor" href="#summary-8"><i class="fas fa-link"></i></a>
</h2>
<p>In this analysis of Usenet messages, we’ve incorporated almost every method for tidy text mining described in this book, ranging from tf-idf to topic modeling and from sentiment analysis to n-gram tokenization. Throughout the chapter, and indeed through all of our case studies, we’ve been able to rely on a small list of common tools for exploration and visualization. We hope that these examples show how much all tidy text analyses have in common with each other, and indeed with all tidy data analyses.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="nasa.html"><span class="header-section-number">8</span> Case study: mining NASA metadata</a></div>
<div class="next"><a href="references.html"><span class="header-section-number">10</span> References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#usenet"><span class="header-section-number">9</span> Case study: analyzing usenet text</a></li>
<li>
<a class="nav-link" href="#pre-processing"><span class="header-section-number">9.1</span> Pre-processing</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#pre-processing-text"><span class="header-section-number">9.1.1</span> Pre-processing text</a></li></ul>
</li>
<li>
<a class="nav-link" href="#words-in-newsgroups"><span class="header-section-number">9.2</span> Words in newsgroups</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#finding-tf-idf-within-newsgroups"><span class="header-section-number">9.2.1</span> Finding tf-idf within newsgroups</a></li>
<li><a class="nav-link" href="#topic-modeling-1"><span class="header-section-number">9.2.2</span> Topic modeling</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sentiment-analysis"><span class="header-section-number">9.3</span> Sentiment analysis</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sentiment-analysis-by-word"><span class="header-section-number">9.3.1</span> Sentiment analysis by word</a></li>
<li><a class="nav-link" href="#sentiment-analysis-by-message"><span class="header-section-number">9.3.2</span> Sentiment analysis by message</a></li>
<li><a class="nav-link" href="#n-gram-analysis"><span class="header-section-number">9.3.3</span> N-gram analysis</a></li>
</ul>
</li>
<li><a class="nav-link" href="#summary-8"><span class="header-section-number">9.4</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/dgrtwo/tidy-text-mining/blob/master/09-usenet.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/dgrtwo/tidy-text-mining/edit/master/09-usenet.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Text Mining with R</strong>: A Tidy Approach" was written by Julia Silge and David Robinson. It was last built on 2022-02-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
